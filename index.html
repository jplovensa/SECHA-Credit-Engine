<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SECHA Credit Engine | Renovation Banking OS</title>
    
    <!-- 1. Load React & ReactDOM -->
    <script crossorigin src="https://cdn.jsdelivr.net/npm/react@18.2.0/umd/react.production.min.js"></script>
    <script crossorigin src="https://cdn.jsdelivr.net/npm/react-dom@18.2.0/umd/react-dom.production.min.js"></script>
    
    <!-- 2. Load Prop-Types -->
    <script src="https://cdn.jsdelivr.net/npm/prop-types@15.8.1/prop-types.min.js"></script>
    
    <!-- 3. Load Recharts -->
    <script src="https://cdn.jsdelivr.net/npm/recharts@2.10.3/umd/Recharts.min.js"></script>
    
    <!-- 4. Load Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- 5. Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- 6. Load Lucide Icons (Specific Version to match Mapping) -->
    <!-- Using 0.460.0 for wide compatibility -->
    <script src="https://unpkg.com/lucide@0.460.0/dist/umd/lucide.min.js"></script>

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">

    <style>
        /* Base Styles */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #050505;
            color: #e4e4e7; /* zinc-200 */
        }
        
        .font-mono {
            font-family: 'JetBrains Mono', monospace;
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }
        ::-webkit-scrollbar-track {
            background: transparent;
        }
        ::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        /* Glassmorphism Utilities */
        .glass-panel {
            background: rgba(18, 18, 18, 0.6);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.3);
        }

        /* Animations */
        @keyframes spin-slow {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        .animate-spin-slow {
            animation: spin-slow 8s linear infinite;
        }
        
        /* Range Slider Styling */
        input[type=range] {
            -webkit-appearance: none;
            width: 100%;
            background: transparent;
        }
        input[type=range]:focus {
            outline: none;
        }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 16px;
            width: 16px;
            border-radius: 50%;
            background: #3b82f6;
            cursor: pointer;
            margin-top: -6px;
            box-shadow: 0 0 10px rgba(59, 130, 246, 0.5);
        }
        input[type=range]::-webkit-slider-runnable-track {
            width: 100%;
            height: 4px;
            cursor: pointer;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 2px;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        // --- 1. SETUP LIBRARIES ---
        const { useState, useEffect } = React;
        
        // Ensure Recharts is loaded and handle UMD default export if present
        const RechartsObj = window.Recharts ? (window.Recharts.default || window.Recharts) : null;
        
        // Fallback Shim if Recharts fails to load
        const Recharts = RechartsObj || {
            LineChart: () => null, Line: () => null, AreaChart: () => null, Area: () => null,
            XAxis: () => null, YAxis: () => null, CartesianGrid: () => null, Tooltip: () => null,
            ResponsiveContainer: ({children}) => <div>{children}</div>, BarChart: () => null, Bar: () => null,
            Cell: () => null, PieChart: () => null, Pie: () => null
        };

        const { 
            LineChart, Line, AreaChart, Area, XAxis, YAxis, 
            CartesianGrid, Tooltip, ResponsiveContainer, 
            BarChart, Bar, Cell, PieChart: RePieChart, Pie 
        } = Recharts;

        // --- 2. ICON SYSTEM (ROBUST FIX) ---
        
        // Mapping for renamed icons between Lucide versions
        const ICON_MAPPING = {
            'PieChart': 'ChartPie',
            'CheckCircle2': 'CircleCheck',
            'AlertCircle': 'CircleAlert', 
            'AlertTriangle': 'TriangleAlert',
            'Edit': 'Pencil',
            'UploadCloud': 'CloudUpload'
        };

        const LucideIcon = ({ name, size = 24, className = "", ...props }) => {
            // 1. Check if Library Loaded
            if (!window.lucide || !window.lucide.icons) {
                console.warn("Lucide library not loaded");
                return <span style={{width: size, height: size, display: 'inline-block', backgroundColor: '#333', borderRadius: '4px'}}></span>; 
            }
            
            // 2. Resolve Name
            let resolvedName = name;
            // Check direct mapping first (case sensitive usually PascalCase)
            if (!window.lucide.icons[resolvedName]) {
                // Check if it exists in our mapping
                if (ICON_MAPPING[name]) {
                    resolvedName = ICON_MAPPING[name];
                }
            }

            const iconData = window.lucide.icons[resolvedName];
            
            // 3. Fallback if still missing
            if (!iconData) {
                console.warn(`Icon "${name}" (resolved: "${resolvedName}") not found in Lucide library.`);
                // Render a generic fallback SVG (a box)
                return (
                    <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className} {...props}>
                        <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                    </svg>
                );
            }

            // 4. Render Icon
            // Lucide UMD format: [tag, attrs, children]
            const tag = iconData[0];
            const attrs = iconData[1];
            const children = iconData[2];

            return React.createElement(
                tag,
                {
                    ...attrs,
                    width: size,
                    height: size,
                    className: `lucide lucide-${name} ${className}`,
                    ...props,
                    viewBox: "0 0 24 24",
                    fill: "none",
                    stroke: "currentColor",
                    strokeWidth: 2,
                    strokeLinecap: "round",
                    strokeLinejoin: "round"
                },
                Array.isArray(children) 
                    ? children.map((child, index) => {
                        const childTag = child[0];
                        const childAttrs = child[1];
                        return React.createElement(childTag, { ...childAttrs, key: index });
                      })
                    : null
            );
        };

        const Icons = new Proxy({}, {
            get: (target, prop) => {
                return (props) => <LucideIcon name={prop} {...props} />;
            }
        });

        // Destructure icons used
        const { 
            Activity, Layers, Cpu, ShieldCheck, TrendingUp, Users, Settings, 
            Search, Bell, Menu, ArrowUpRight, ArrowDownRight, CheckCircle2, 
            AlertCircle, Clock, Zap, LayoutGrid, PieChart, GitCommit, Share2, 
            Building2, Wallet, Coins, ArrowRight, RefreshCw, Lock, Globe, 
            MoreHorizontal, Landmark, FileCheck, HardHat, Scale, Camera, 
            UploadCloud, UserCircle, LogOut, FileText, Calendar, AlertTriangle, 
            ChevronRight, Download, Pencil
        } = Icons;

        // --- 3. MOCK DATA & CONSTANTS ---
        const PHASE_CONFIG = {
            1: { label: 'Phase 1: Foundation', badge: 'Rule-Based', color: 'text-blue-400', bg: 'bg-blue-500/10', border: 'border-blue-500/20' },
            2: { label: 'Phase 2: Integration', badge: 'Hybrid', color: 'text-purple-400', bg: 'bg-purple-500/10', border: 'border-purple-500/20' },
            3: { label: 'Phase 3: Neural Engine', badge: 'Autonomous', color: 'text-emerald-400', bg: 'bg-emerald-500/10', border: 'border-emerald-500/20' }
        };

        const MOCK_PERFORMANCE_DATA = [
            { name: 'Mon', risk: 40, uplift: 12, volume: 2400 },
            { name: 'Tue', risk: 30, uplift: 15, volume: 1398 },
            { name: 'Wed', risk: 20, uplift: 18, volume: 9800 },
            { name: 'Thu', risk: 27, uplift: 22, volume: 3908 },
            { name: 'Fri', risk: 18, uplift: 24, volume: 4800 },
            { name: 'Sat', risk: 23, uplift: 28, volume: 3800 },
            { name: 'Sun', risk: 14, uplift: 32, volume: 4300 },
        ];

        const PORTFOLIO_DATA = [
            { name: 'Verified', value: 65, color: '#10B981' }, 
            { name: 'In Progress', value: 25, color: '#3B82F6' },
            { name: 'Watchlist', value: 8, color: '#F59E0B' }, 
            { name: 'Default', value: 2, color: '#EF4444' }, 
        ];

        const ORIGINATION_OPPORTUNITIES = [
            { id: 'LN-2024-882', title: 'Menteng Heritage Restoration', location: 'Menteng, Jakarta Pusat', ltv: '62%', uplift: '+24%', amount: 2500000000, progress: 75, status: 'Ready to Fund', bankability: 98, image: 'linear-gradient(135deg, #172554 0%, #000 100%)' },
            { id: 'LN-2024-883', title: 'BSD City Cluster Expansion', location: 'BSD City, Tangerang', ltv: '68%', uplift: '+18%', amount: 5000000000, progress: 40, status: 'Drawdown Verification', bankability: 92, image: 'linear-gradient(135deg, #022c22 0%, #000 100%)' },
            { id: 'LN-2024-884', title: 'Surabaya Retail Fitout', location: 'Tunjungan, Surabaya', ltv: '75%', uplift: '+15%', amount: 800000000, progress: 100, status: 'Pending Approval', bankability: 85, image: 'linear-gradient(135deg, #451a03 0%, #000 100%)' },
        ];

        const RECENT_APPLICATIONS = [
            { id: 'REQ-001', name: 'Cluster A: Foundation', value: 'IDR 450M', score: 98, status: 'Verified', type: 'Drawdown' },
            { id: 'REQ-002', name: 'Green Lake: Material', value: 'IDR 820M', score: 72, status: 'Auditing', type: 'Purchase' },
            { id: 'REQ-003', name: 'Urban Suite: Final', value: 'IDR 1.2B', score: 45, status: 'Rejected', type: 'Completion' },
            { id: 'REQ-004', name: 'Sentul: Phase 1', value: 'IDR 300M', score: 89, status: 'Verified', type: 'Drawdown' },
        ];

        const SCORING_NODES = [
            { label: 'Contractor Audit', weight: 95, status: 'optimal' },
            { label: 'Cost Certification', weight: 88, status: 'optimal' },
            { label: 'Timeline Variance', weight: 72, status: 'stable' },
            { label: 'Post-Reno Appraisal', weight: 98, status: 'optimal' },
        ];

        const BORROWER_MILESTONES = [
            { id: 1, title: 'Project Initiation', date: 'Oct 12', status: 'completed', amount: 'Rp 250M', desc: 'Initial deposit and site preparation.' },
            { id: 2, title: 'Foundation & Structure', date: 'Nov 05', status: 'completed', amount: 'Rp 450M', desc: 'Concrete pouring and structural reinforcement.' },
            { id: 3, title: 'MEP & Installation', date: 'Dec 01', status: 'active', amount: 'Rp 300M', desc: 'Mechanical, Electrical, and Plumbing works.' },
            { id: 4, title: 'Finishing Works', date: 'Est. Jan 15', status: 'locked', amount: 'Rp 200M', desc: 'Flooring, painting, and fixture installation.' },
            { id: 5, title: 'Final Handover', date: 'Est. Feb 01', status: 'locked', amount: 'Rp 150M', desc: 'Quality assurance check and key handover.' },
        ];

        const BORROWER_DOCS = [
            { id: 1, name: 'KTP (ID Card)', type: 'Identity', status: 'verified', date: 'Oct 10, 2024' },
            { id: 2, name: 'Property Deed (SHM)', type: 'Collateral', status: 'verified', date: 'Oct 10, 2024' },
            { id: 3, name: 'RAB (Budget Plan)', type: 'Project', status: 'verified', date: 'Oct 11, 2024' },
            { id: 4, name: 'Contractor Agreement', type: 'Legal', status: 'verified', date: 'Oct 15, 2024' },
            { id: 5, name: 'IMB / PBG Permit', type: 'Legal', status: 'pending', date: '-', action: 'Upload Required' },
            { id: 6, name: 'MEP Progress Photos', type: 'Evidence', status: 'uploading', date: 'Today', action: 'Processing...' },
        ];

        // --- 4. SHARED COMPONENTS ---

        const GlassCard = ({ children, className = "", hover = true, noPadding = false, ...props }) => (
            <div className={`
                glass-panel relative overflow-hidden rounded-2xl
                ${hover ? 'transition-all duration-300 hover:bg-[#1A1A1A]/80 hover:border-white/15 hover:-translate-y-1' : ''}
                ${noPadding ? '' : 'p-6'}
                ${className}
            `} {...props}>
                {children}
            </div>
        );

        const StatusBadge = ({ status }) => {
            const styles = {
                Verified: 'bg-emerald-500/10 text-emerald-400 border-emerald-500/20',
                verified: 'bg-emerald-500/10 text-emerald-400 border-emerald-500/20',
                Completed: 'bg-emerald-500/10 text-emerald-400 border-emerald-500/20',
                completed: 'bg-emerald-500/10 text-emerald-400 border-emerald-500/20',
                Auditing: 'bg-blue-500/10 text-blue-400 border-blue-500/20 animate-pulse',
                Active: 'bg-blue-500/10 text-blue-400 border-blue-500/20',
                active: 'bg-blue-500/10 text-blue-400 border-blue-500/20',
                uploading: 'bg-amber-500/10 text-amber-400 border-amber-500/20 animate-pulse',
                Rejected: 'bg-red-500/10 text-red-400 border-red-500/20',
                pending: 'bg-zinc-500/10 text-zinc-400 border-zinc-500/20',
                locked: 'bg-zinc-800/50 text-zinc-600 border-zinc-700/30',
                'Ready to Fund': 'bg-emerald-500/10 text-emerald-400 border-emerald-500/20',
                'Drawdown Verification': 'bg-amber-500/10 text-amber-400 border-amber-500/20',
                'Pending Approval': 'bg-zinc-500/10 text-zinc-400 border-zinc-500/20',
            };
            return (
                <span className={`px-2.5 py-1 rounded-full text-[10px] uppercase font-bold tracking-wider border ${styles[status] || styles.pending}`}>
                    {status}
                </span>
            );
        };

        const Navigation = ({ activeTab, setActiveTab, userRole }) => {
            const bankItems = [
                { id: 'dashboard', icon: LayoutGrid, label: 'Bank View' },
                { id: 'engine', icon: Cpu, label: 'Risk Engine' },
                { id: 'portfolio', icon: PieChart, label: 'Asset Book' },
                { id: 'origination', icon: FileCheck, label: 'Origination' },
                { id: 'settings', icon: Settings, label: 'Config' },
            ];
            const borrowerItems = [
                { id: 'dashboard', icon: LayoutGrid, label: 'My Project' },
                { id: 'documents', icon: FileText, label: 'Documents' },
                { id: 'milestones', icon: TrendingUp, label: 'Milestones' },
                { id: 'settings', icon: Settings, label: 'Settings' },
            ];
            const items = userRole === 'bank' ? bankItems : borrowerItems;

            return (
                <React.Fragment>
                    <div className="hidden md:flex w-20 lg:w-64 flex-shrink-0 border-r border-white/5 bg-black/40 backdrop-blur-xl flex-col justify-between p-3 lg:p-4 h-screen sticky top-0 z-50 transition-all duration-300">
                        <div>
                            <div className="flex items-center gap-3 px-2 mb-10 mt-2">
                                <div className="w-8 h-8 rounded-xl bg-gradient-to-br from-blue-600 to-indigo-700 flex items-center justify-center text-white font-bold shrink-0 shadow-[0_0_15px_rgba(59,130,246,0.5)]">S</div>
                                <span className="hidden lg:block font-semibold text-lg tracking-tight text-white/90">SECHA</span>
                            </div>
                            <div className="space-y-1">
                                {items.map((item) => (
                                    <button key={item.id} onClick={() => setActiveTab(item.id)} className={`w-full flex items-center gap-3 px-3 py-3 rounded-xl text-sm font-medium transition-all duration-200 group relative ${activeTab === item.id ? 'bg-white/10 text-white shadow-inner' : 'text-zinc-500 hover:text-zinc-200 hover:bg-white/5'}`}>
                                        <item.icon size={20} strokeWidth={2} className={`${activeTab === item.id ? 'text-blue-400' : 'group-hover:text-zinc-300'} transition-colors`} />
                                        <span className="hidden lg:block">{item.label}</span>
                                        {activeTab === item.id && <div className="absolute right-0 top-1/2 -translate-y-1/2 w-1 h-8 bg-blue-500 rounded-l-full shadow-[0_0_10px_rgba(59,130,246,0.8)] hidden lg:block" />}
                                    </button>
                                ))}
                            </div>
                        </div>
                        <div className="hidden lg:block p-4 rounded-xl bg-gradient-to-b from-white/5 to-transparent border border-white/5">
                            <div className="flex items-center gap-2 mb-2 text-xs text-zinc-400">
                                <ShieldCheck size={14} />
                                <span>{userRole === 'bank' ? 'Bank Grade Security' : 'Verified Borrower'}</span>
                            </div>
                            <div className="flex items-center gap-2 text-sm text-emerald-400 font-medium">
                                <div className="w-2 h-2 rounded-full bg-emerald-500 animate-pulse shadow-[0_0_8px_rgba(16,185,129,0.6)]" />
                                {userRole === 'bank' ? 'SOC2 Compliant' : 'Active Loan'}
                            </div>
                        </div>
                    </div>
                    <div className="md:hidden fixed bottom-0 left-0 right-0 h-16 bg-[#0a0a0a]/90 backdrop-blur-xl border-t border-white/10 z-50 flex items-center justify-around px-2 pb-safe">
                        {items.map((item) => (
                            <button key={item.id} onClick={() => setActiveTab(item.id)} className={`flex flex-col items-center justify-center p-2 rounded-lg transition-all w-16 ${activeTab === item.id ? 'text-blue-400' : 'text-zinc-500'}`}>
                                <item.icon size={20} strokeWidth={activeTab === item.id ? 2.5 : 2} className="mb-1" />
                                <span className="text-[10px] font-medium">{item.label}</span>
                            </button>
                        ))}
                    </div>
                </React.Fragment>
            );
        };

        // --- 5. VIEWS ---

        const DashboardView = ({ phase }) => (
            <div className="space-y-6">
                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 lg:gap-6">
                    {[
                        { label: 'Value Uplift Created', value: '+22.4%', change: 'Asset Appreciation', icon: TrendingUp, color: 'text-emerald-400', glow: 'shadow-emerald-500/20' },
                        { label: 'Post-Reno LTV', value: '64.5%', change: '-12% Risk Reduction', icon: Scale, color: 'text-blue-400', glow: 'shadow-blue-500/20' },
                        { label: 'Disbursement Control', value: '100%', sub: 'Zero Premature Release', icon: Lock, color: 'text-amber-400', glow: 'shadow-amber-500/20' },
                        { label: 'Active Exposure', value: 'Rp 42.5B', change: 'Fully Collateralized', icon: Building2, color: 'text-zinc-200', glow: 'shadow-white/10' },
                    ].map((stat, i) => (
                        <GlassCard key={i}>
                            <div className="flex justify-between items-start mb-4">
                                <div className={`p-3 rounded-xl bg-white/5 ${stat.color} shadow-lg ${stat.glow}`}><stat.icon size={20} /></div>
                                {stat.change && <span className="flex items-center gap-1 text-[10px] uppercase font-bold text-zinc-500 bg-white/5 px-2 py-1 rounded-full border border-white/5">{stat.change}</span>}
                            </div>
                            <div className="space-y-1">
                                <h3 className="text-zinc-500 text-sm font-medium">{stat.label}</h3>
                                <p className="text-2xl lg:text-3xl font-semibold text-white tracking-tight">{stat.value}</p>
                                {stat.sub && <p className="text-xs text-zinc-500">{stat.sub}</p>}
                            </div>
                        </GlassCard>
                    ))}
                </div>
                <div className="grid grid-cols-1 xl:grid-cols-3 gap-6 h-full">
                    <div className="xl:col-span-2 space-y-6">
                        <GlassCard className="h-[400px]">
                            <div className="flex justify-between items-center mb-6">
                                <div><h3 className="text-white font-medium text-lg">Value Creation Velocity</h3><p className="text-zinc-500 text-sm">Collateral value appreciation vs. Risk exposure</p></div>
                                <div className="flex gap-2">
                                    <span className="flex items-center gap-2 text-xs text-zinc-400 px-3 py-1 bg-white/5 rounded-lg border border-white/5"><div className="w-2 h-2 rounded-full bg-emerald-400" /> Asset Value</span>
                                    <span className="flex items-center gap-2 text-xs text-zinc-400 px-3 py-1 bg-white/5 rounded-lg border border-white/5"><div className="w-2 h-2 rounded-full bg-blue-500" /> Loan Balance</span>
                                </div>
                            </div>
                            <ResponsiveContainer width="100%" height="80%">
                                <AreaChart data={MOCK_PERFORMANCE_DATA}>
                                    <defs>
                                        <linearGradient id="colorUplift" x1="0" y1="0" x2="0" y2="1"><stop offset="5%" stopColor="#10B981" stopOpacity={0.3}/><stop offset="95%" stopColor="#10B981" stopOpacity={0}/></linearGradient>
                                        <linearGradient id="colorVol" x1="0" y1="0" x2="0" y2="1"><stop offset="5%" stopColor="#3B82F6" stopOpacity={0.1}/><stop offset="95%" stopColor="#3B82F6" stopOpacity={0}/></linearGradient>
                                    </defs>
                                    <CartesianGrid strokeDasharray="3 3" stroke="#ffffff05" vertical={false} />
                                    <XAxis dataKey="name" axisLine={false} tickLine={false} tick={{fill: '#71717a', fontSize: 12}} />
                                    <YAxis axisLine={false} tickLine={false} tick={{fill: '#71717a', fontSize: 12}} />
                                    <Tooltip contentStyle={{ backgroundColor: 'rgba(24, 24, 27, 0.9)', backdropFilter: 'blur(10px)', border: '1px solid rgba(255,255,255,0.1)', borderRadius: '12px' }} itemStyle={{ color: '#fff' }} />
                                    <Area type="monotone" dataKey="uplift" stackId="1" stroke="#10B981" strokeWidth={2} fillOpacity={1} fill="url(#colorUplift)" name="Value Uplift" />
                                    <Area type="monotone" dataKey="volume" stackId="2" stroke="#3B82F6" strokeWidth={2} fillOpacity={1} fill="url(#colorVol)" name="Loan Balance" />
                                </AreaChart>
                            </ResponsiveContainer>
                        </GlassCard>
                        {phase === 3 && (
                            <GlassCard>
                                <h3 className="text-white font-medium mb-4 flex items-center gap-2"><ShieldCheck size={18} className="text-emerald-400" /> Real-time Compliance Checks</h3>
                                <div className="grid grid-cols-1 md:grid-cols-3 gap-3">
                                    {[{ label: 'KYC/AML Watchlist', status: 'CLEAN' }, { label: 'Contractor License', status: 'VERIFIED' }, { label: 'Permit Validation', status: 'ACTIVE' }].map((item, i) => (
                                        <div key={i} className="flex items-center justify-between p-3 rounded-lg bg-white/5 border border-white/5 hover:bg-white/10 transition-colors">
                                            <span className="text-xs text-zinc-300 font-medium">{item.label}</span>
                                            <div className="flex items-center gap-2"><div className="w-1.5 h-1.5 rounded-full bg-emerald-500 animate-pulse" /><span className="text-[10px] font-bold text-emerald-400 tracking-wider">{item.status}</span></div>
                                        </div>
                                    ))}
                                </div>
                            </GlassCard>
                        )}
                    </div>
                    <div className="space-y-6">
                        <GlassCard className="min-h-[400px]">
                            <div className="flex justify-between items-center mb-6">
                                <h3 className="text-white font-medium text-lg">Drawdown Requests</h3>
                                <div className="bg-amber-500/10 border border-amber-500/20 text-amber-400 px-2 py-1 rounded text-[10px] font-bold uppercase">Action Required</div>
                            </div>
                            <div className="space-y-4">
                                {RECENT_APPLICATIONS.map((app) => (
                                    <div key={app.id} className="group p-4 rounded-xl bg-white/5 border border-white/5 hover:border-white/10 hover:bg-white/10 transition-all cursor-pointer">
                                        <div className="flex justify-between items-start mb-2">
                                            <div><h4 className="text-sm font-medium text-white group-hover:text-blue-400 transition-colors">{app.name}</h4><p className="text-xs text-zinc-500 flex items-center gap-1 mt-0.5"><HardHat size={10} /> {app.type}</p></div>
                                            <StatusBadge status={app.status} />
                                        </div>
                                        <div className="flex justify-between items-center mt-3 pt-3 border-t border-white/5">
                                            <div className="flex flex-col"><span className="text-[10px] text-zinc-500 uppercase tracking-wider">Release Amount</span><span className="text-sm font-semibold text-zinc-200">{app.value}</span></div>
                                            <div className="flex flex-col items-end"><span className="text-[10px] text-zinc-500 uppercase tracking-wider">Verification Score</span><span className={`text-sm font-bold font-mono ${app.score > 90 ? 'text-emerald-400' : 'text-amber-400'}`}>{app.score}/100</span></div>
                                        </div>
                                    </div>
                                ))}
                            </div>
                            <button className="w-full mt-6 py-3 rounded-xl bg-blue-600 hover:bg-blue-500 text-white shadow-lg shadow-blue-600/20 text-sm font-medium transition-all flex items-center justify-center gap-2"><CheckCircle2 size={16} /> Batch Approve Verified</button>
                        </GlassCard>
                    </div>
                </div>
            </div>
        );

        const EngineView = () => {
            const [inputs, setInputs] = useState({ contractor: 85, asset: 92, ltv: 75, credit: 68 });
            const score = Math.min(100, Math.floor((inputs.contractor * 0.35) + (inputs.asset * 0.30) + ((100 - inputs.ltv + 20) * 0.20) + (inputs.credit * 0.15)));

            return (
                <div className="h-full flex flex-col gap-6">
                    <div className="flex flex-col md:flex-row md:justify-between md:items-end gap-4">
                        <div><h2 className="text-2xl font-semibold text-white mb-2">Bankability Risk Engine</h2><p className="text-zinc-400 max-w-xl text-sm leading-relaxed">Proprietary model calculating <strong>Post-Renovation LTV</strong> and <strong>Contractor Delivery Risk</strong> to safeguard institutional capital.</p></div>
                        <div className="flex gap-3"><button className="px-4 py-2 bg-white/5 hover:bg-white/10 text-white rounded-lg text-sm font-medium transition-colors border border-white/10 flex items-center gap-2"><FileCheck size={16} /> Export Audit Trail</button></div>
                    </div>
                    <div className="grid grid-cols-1 lg:grid-cols-4 gap-6 flex-grow">
                        <GlassCard className="lg:col-span-3 p-8 flex flex-col gap-8 bg-grid-white/[0.02] min-h-[500px]">
                            <div className="flex justify-between items-center border-b border-white/5 pb-6"><h3 className="text-lg font-medium text-white flex items-center gap-2"><Cpu className="text-blue-400" size={20} /> Live Scoring Simulator</h3><span className="text-xs text-zinc-500 font-mono">MODEL v3.2.1</span></div>
                            <div className="grid grid-cols-1 lg:grid-cols-2 gap-12 flex-1 items-center">
                                <div className="space-y-8">
                                    <div className="space-y-3"><div className="flex justify-between"><label className="text-sm font-medium text-zinc-300 flex items-center gap-2"><HardHat size={14} className="text-blue-400" /> Contractor Reliability</label><span className="font-mono text-blue-400 font-bold">{inputs.contractor}/100</span></div><input type="range" min="0" max="100" value={inputs.contractor} onChange={(e) => setInputs({...inputs, contractor: parseInt(e.target.value)})} /><div className="text-[10px] text-zinc-500">Weight: 35% (Highest Criticality)</div></div>
                                    <div className="space-y-3"><div className="flex justify-between"><label className="text-sm font-medium text-zinc-300 flex items-center gap-2"><Building2 size={14} className="text-emerald-400" /> Post-Reno Asset Quality</label><span className="font-mono text-emerald-400 font-bold">{inputs.asset}/100</span></div><input type="range" min="0" max="100" value={inputs.asset} onChange={(e) => setInputs({...inputs, asset: parseInt(e.target.value)})} /><div className="text-[10px] text-zinc-500">Weight: 30% (Collateral Backing)</div></div>
                                    <div className="space-y-3"><div className="flex justify-between"><label className="text-sm font-medium text-zinc-300 flex items-center gap-2"><Scale size={14} className="text-amber-400" /> Loan-to-Value (LTV)</label><span className="font-mono text-amber-400 font-bold">{inputs.ltv}%</span></div><input type="range" min="0" max="100" value={inputs.ltv} onChange={(e) => setInputs({...inputs, ltv: parseInt(e.target.value)})} /><div className="text-[10px] text-zinc-500">Weight: 20% (Risk Exposure)</div></div>
                                    <div className="space-y-3"><div className="flex justify-between"><label className="text-sm font-medium text-zinc-300 flex items-center gap-2"><UserCircle size={14} className="text-purple-400" /> Personal Credit</label><span className="font-mono text-purple-400 font-bold">{inputs.credit}/100</span></div><input type="range" min="0" max="100" value={inputs.credit} onChange={(e) => setInputs({...inputs, credit: parseInt(e.target.value)})} /><div className="text-[10px] text-zinc-500">Weight: 15% (Secondary Factor)</div></div>
                                </div>
                                <div className="flex flex-col items-center justify-center p-8 rounded-3xl bg-black/40 border border-white/5 relative overflow-hidden">
                                    <div className="absolute inset-0 bg-gradient-to-tr from-blue-500/5 to-emerald-500/5" />
                                    <div className="relative z-10 text-center space-y-2"><div className="text-sm font-medium text-zinc-500 uppercase tracking-widest">Bankability Score</div><div className={`text-6xl font-bold font-mono transition-all duration-300 ${score >= 80 ? 'text-emerald-400' : score >= 60 ? 'text-amber-400' : 'text-rose-400'}`}>{score}</div></div>
                                    <div className="mt-8 w-full space-y-2"><div className="flex justify-between text-xs font-medium text-zinc-400"><span>Risk Assessment</span><span className={score >= 80 ? 'text-emerald-400' : score >= 60 ? 'text-amber-400' : 'text-rose-400'}>{score >= 80 ? 'LOW RISK' : score >= 60 ? 'MODERATE' : 'HIGH RISK'}</span></div><div className="h-2 w-full bg-zinc-800 rounded-full overflow-hidden"><div className={`h-full transition-all duration-300 ${score >= 80 ? 'bg-emerald-500' : score >= 60 ? 'bg-amber-500' : 'bg-rose-500'}`} style={{width: `${score}%`}} /></div><p className="text-[10px] text-zinc-500 text-center pt-2">{score >= 80 ? 'Eligible for Automated Disbursement' : 'Manual Underwriting Required'}</p></div>
                                </div>
                            </div>
                        </GlassCard>
                        <div className="space-y-6">
                            <GlassCard className="h-full flex flex-col justify-between">
                                <div>
                                    <h3 className="text-white font-medium mb-6">Risk Calibration</h3>
                                    <div className="space-y-6">
                                        {SCORING_NODES.map((node, i) => (
                                            <div key={i}><div className="flex justify-between mb-2"><span className="text-sm text-zinc-300">{node.label}</span><span className="text-xs font-mono text-zinc-500">{node.weight}%</span></div><div className="h-1.5 bg-zinc-800 rounded-full overflow-hidden"><div className={`h-full rounded-full transition-all duration-1000 ${node.status === 'warning' ? 'bg-amber-500' : 'bg-emerald-500 shadow-[0_0_8px_rgba(16,185,129,0.5)]'}`} style={{ width: `${node.weight}%` }} /></div></div>
                                        ))}
                                    </div>
                                </div>
                                <div className="pt-6 border-t border-white/5"><h4 className="text-xs font-semibold text-zinc-500 uppercase tracking-wider mb-3">Lender Safeguards</h4><div className="p-3 rounded-lg bg-emerald-500/10 border border-emerald-500/20 flex items-center gap-3"><CheckCircle2 size={16} className="text-emerald-400 shrink-0" /><div className="flex flex-col"><span className="text-xs text-emerald-300 font-medium">Cost Overrun Protection</span><span className="text-[10px] text-emerald-500/70">Guaranteed by Contractor Bond</span></div></div></div>
                            </GlassCard>
                        </div>
                    </div>
                </div>
            );
        };

        const PortfolioView = () => (
            <div className="space-y-6 animate-in fade-in slide-in-from-bottom-4 duration-500">
                <div className="flex flex-col md:flex-row md:items-center justify-between mb-2 gap-4"><h2 className="text-2xl font-semibold text-white">Asset Book Performance</h2><div className="flex gap-2"><button className="flex items-center gap-2 px-3 py-1.5 bg-zinc-800/50 hover:bg-zinc-800 text-zinc-400 hover:text-white rounded-lg text-xs font-medium transition-colors border border-white/5"><ArrowDownRight size={14} /> Regulatory Report</button></div></div>
                <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
                    <GlassCard className="min-h-[350px]">
                        <h3 className="text-white font-medium mb-6">Risk Tranches</h3>
                        <div className="flex flex-col md:flex-row items-center gap-8 h-64">
                            <ResponsiveContainer width="100%" height="100%"><RePieChart><Pie data={PORTFOLIO_DATA} cx="50%" cy="50%" innerRadius={60} outerRadius={80} paddingAngle={5} dataKey="value" stroke="none">{PORTFOLIO_DATA.map((entry, index) => <Cell key={`cell-${index}`} fill={entry.color} />)}</Pie><Tooltip contentStyle={{ backgroundColor: 'rgba(24, 24, 27, 0.8)', backdropFilter: 'blur(10px)', border: '1px solid rgba(255,255,255,0.1)', borderRadius: '12px' }} itemStyle={{ color: '#fff' }} /></RePieChart></ResponsiveContainer>
                            <div className="space-y-3 w-full md:w-auto">{PORTFOLIO_DATA.map((item, i) => (<div key={i} className="flex items-center justify-between gap-8"><div className="flex items-center gap-2"><div className="w-2 h-2 rounded-full shadow-[0_0_8px_rgba(255,255,255,0.3)]" style={{ backgroundColor: item.color }} /><span className="text-sm text-zinc-300">{item.name}</span></div><span className="text-sm font-mono text-zinc-500">{item.value}%</span></div>))}</div>
                        </div>
                    </GlassCard>
                    <div className="lg:col-span-2 grid grid-cols-1 md:grid-cols-2 gap-6">
                        <GlassCard><div className="flex items-start justify-between mb-4"><div className="p-2 bg-emerald-500/10 rounded-lg text-emerald-400 border border-emerald-500/10"><Wallet size={20} /></div><span className="text-xs text-zinc-500 font-mono">COLLATERAL VALUE</span></div><div className="space-y-1"><span className="text-zinc-500 text-sm">Post-Renovation Value</span><h4 className="text-3xl font-semibold text-white">Rp 186.2B</h4><div className="flex items-center gap-2 text-xs"><span className="text-emerald-400 flex items-center gap-1">+22% <ArrowUpRight size={10} /></span><span className="text-zinc-600">vs Pre-Reno Value</span></div></div></GlassCard>
                        <GlassCard><div className="flex items-start justify-between mb-4"><div className="p-2 bg-red-500/10 rounded-lg text-red-400 border border-red-500/10"><AlertCircle size={20} /></div><span className="text-xs text-zinc-500 font-mono">RISK METRICS</span></div><div className="space-y-1"><span className="text-zinc-500 text-sm">Projected NPL Ratio</span><h4 className="text-3xl font-semibold text-white">0.8%</h4><div className="flex items-center gap-2 text-xs"><span className="text-emerald-400 flex items-center gap-1">-0.4% <ArrowDownRight size={10} /></span><span className="text-zinc-600">vs Industry Avg</span></div></div></GlassCard>
                        <GlassCard className="md:col-span-2"><h3 className="text-white font-medium mb-4">Repayment vs Value Unlock</h3><div className="h-48"><ResponsiveContainer width="100%" height="100%"><BarChart data={MOCK_PERFORMANCE_DATA}><CartesianGrid strokeDasharray="3 3" stroke="#ffffff05" vertical={false} /><XAxis dataKey="name" axisLine={false} tickLine={false} tick={{fill: '#71717a', fontSize: 12}} /><Tooltip cursor={{fill: '#ffffff05'}} contentStyle={{ backgroundColor: 'rgba(24, 24, 27, 0.8)', backdropFilter: 'blur(10px)', border: '1px solid rgba(255,255,255,0.1)', borderRadius: '12px' }} /><Bar dataKey="uplift" fill="#10B981" radius={[4, 4, 0, 0]} maxBarSize={40} name="Value Created" /></BarChart></ResponsiveContainer></div></GlassCard>
                    </div>
                </div>
            </div>
        );

        const OriginationView = () => (
            <div className="space-y-6 animate-in fade-in slide-in-from-bottom-4 duration-500">
                <div className="flex flex-col md:flex-row md:items-center justify-between gap-4 mb-4"><div><h2 className="text-2xl font-semibold text-white">Live Deal Flow</h2><p className="text-zinc-400 text-sm">Pre-vetted renovation loans ready for underwriting. Secha verified.</p></div><div className="flex gap-2"><button className="px-4 py-2 bg-blue-600 hover:bg-blue-500 text-white rounded-lg text-sm font-medium transition-colors shadow-lg shadow-blue-500/20 flex items-center gap-2"><Landmark size={16} /> Allocation Overview</button></div></div>
                <div className="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6">
                    {ORIGINATION_OPPORTUNITIES.map((deal) => (
                        <GlassCard key={deal.id} noPadding className="group cursor-pointer border-0 ring-1 ring-white/5 hover:ring-white/10">
                            <div className="h-48 relative p-6 flex flex-col justify-between overflow-hidden"><div className="absolute inset-0" style={{ background: deal.image }} /><div className="absolute inset-0 bg-gradient-to-t from-black/80 via-black/20 to-transparent" /><div className="relative z-10 flex justify-between items-start"><StatusBadge status={deal.status} /><button className="p-2 rounded-full bg-white/10 hover:bg-white/20 backdrop-blur-md text-white transition-colors border border-white/10"><ArrowUpRight size={16} /></button></div><div className="relative z-10"><h3 className="text-white font-semibold text-xl leading-tight mb-2 drop-shadow-md">{deal.title}</h3><div className="flex items-center gap-1.5 text-zinc-200 text-xs font-medium bg-black/30 w-fit px-2 py-1 rounded-full backdrop-blur-sm"><Globe size={12} className="text-blue-400" /> {deal.location}</div></div></div>
                            <div className="p-6"><div className="grid grid-cols-2 gap-4 mb-6"><div className="p-3 rounded-xl bg-white/5 border border-white/5"><span className="text-[10px] text-zinc-500 uppercase font-bold block mb-1">Bankability Score</span><span className="text-xl font-bold text-emerald-400 font-mono">{deal.bankability}</span></div><div className="p-3 rounded-xl bg-white/5 border border-white/5"><span className="text-[10px] text-zinc-500 uppercase font-bold block mb-1">Value Uplift</span><span className="text-xl font-semibold text-blue-400">{deal.uplift}</span></div></div><div className="space-y-4 mb-6"><div className="flex justify-between items-end"><div><span className="text-xs text-zinc-500 block">Loan Amount</span><span className="text-white font-medium">Rp {deal.amount / 1000000000} Billion</span></div><div className="text-right"><span className="text-xs text-zinc-500 block">LTV (Post-Reno)</span><span className="text-emerald-400 font-medium">{deal.ltv}</span></div></div><div><div className="flex justify-between text-[10px] uppercase font-bold text-zinc-500 mb-1"><span>Verification Progress</span><span>{deal.progress}%</span></div><div className="h-1.5 w-full bg-zinc-800 rounded-full overflow-hidden border border-white/5"><div className="h-full bg-gradient-to-r from-emerald-600 to-emerald-400 rounded-full shadow-[0_0_10px_rgba(16,185,129,0.5)]" style={{ width: `${deal.progress}%` }} /></div></div></div><button className="w-full py-3 rounded-xl bg-white/5 border border-white/10 text-zinc-300 font-medium hover:bg-white/10 hover:text-white transition-all flex items-center justify-center gap-2 group-hover:bg-blue-600 group-hover:border-blue-500 group-hover:text-white group-hover:shadow-[0_0_20px_rgba(37,99,235,0.4)]">View Due Diligence <ArrowRight size={16} /></button></div>
                        </GlassCard>
                    ))}
                </div>
            </div>
        );

        const BorrowerDashboard = ({ setActiveTab }) => (
            <div className="space-y-6 animate-in fade-in slide-in-from-bottom-4 duration-500">
                <div className="flex flex-col md:flex-row md:items-end justify-between gap-4"><div><h2 className="text-2xl font-semibold text-white">Welcome back, Pak Budi</h2><p className="text-zinc-400 text-sm">Project: Menteng Heritage Restoration</p></div><div className="flex items-center gap-2 px-3 py-1.5 bg-emerald-500/10 border border-emerald-500/20 rounded-full"><div className="w-2 h-2 rounded-full bg-emerald-500 animate-pulse" /><span className="text-xs font-medium text-emerald-400">Loan Active â€¢ Disbursing</span></div></div>
                <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <GlassCard className="p-4"><div className="flex justify-between items-start"><span className="text-xs text-zinc-500 font-medium uppercase tracking-wider">Total Facility</span><Wallet size={16} className="text-blue-400" /></div><div className="text-2xl font-bold text-white mt-2">Rp 2.5 M</div><div className="h-1 w-full bg-zinc-800 rounded-full mt-3 overflow-hidden"><div className="h-full bg-blue-500 w-full" /></div></GlassCard>
                    <GlassCard className="p-4"><div className="flex justify-between items-start"><span className="text-xs text-zinc-500 font-medium uppercase tracking-wider">Disbursed</span><Coins size={16} className="text-emerald-400" /></div><div className="text-2xl font-bold text-emerald-400 mt-2">Rp 1.0 M</div><div className="h-1 w-full bg-zinc-800 rounded-full mt-3 overflow-hidden"><div className="h-full bg-emerald-500 w-[40%]" /></div></GlassCard>
                    <GlassCard className="p-4"><div className="flex justify-between items-start"><span className="text-xs text-zinc-500 font-medium uppercase tracking-wider">Next Repayment</span><Calendar size={16} className="text-zinc-400" /></div><div className="text-2xl font-bold text-white mt-2">12 Jan</div><div className="text-xs text-zinc-400 mt-1">Rp 18.500.000 (Interest Only)</div></GlassCard>
                </div>
                <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
                    <div className="space-y-6 lg:col-span-1">
                        <GlassCard><h3 className="text-white font-medium text-sm mb-4 flex items-center gap-2"><AlertCircle size={16} className="text-amber-400" /> Action Required</h3><div className="space-y-3"><div className="p-3 bg-amber-500/10 border border-amber-500/20 rounded-xl cursor-pointer hover:bg-amber-500/20 transition-colors" onClick={() => setActiveTab('milestones')}><div className="flex items-start gap-3"><Camera className="text-amber-400 mt-1" size={16} /><div><h4 className="text-sm text-amber-100 font-medium">Upload Progress Photo</h4><p className="text-[11px] text-amber-500/70 mt-1">MEP Installation phase requires visual verification for next drawdown.</p><button className="mt-2 text-[10px] font-bold text-amber-400 uppercase tracking-wide flex items-center gap-1">Go to Milestones <ArrowRight size={10} /></button></div></div></div><div className="p-3 bg-zinc-800/50 border border-white/5 rounded-xl cursor-pointer hover:bg-white/5 transition-colors" onClick={() => setActiveTab('documents')}><div className="flex items-start gap-3"><FileText className="text-blue-400 mt-1" size={16} /><div><h4 className="text-sm text-zinc-200 font-medium">Missing IMB/PBG Document</h4><p className="text-[11px] text-zinc-500 mt-1">Please upload the permit scan to finalize compliance.</p></div></div></div></div></GlassCard>
                        <GlassCard><h3 className="text-white font-medium text-sm mb-4">Assigned Contractor</h3><div className="flex items-center gap-3 mb-4"><div className="w-10 h-10 bg-zinc-800 rounded-full flex items-center justify-center border border-white/10"><HardHat size={20} className="text-zinc-400" /></div><div><div className="text-sm text-white font-medium">PT Bangun Jaya</div><div className="text-xs text-emerald-400 flex items-center gap-1"><ShieldCheck size={10} /> Verified Partner</div></div></div><button className="w-full py-2 border border-white/10 rounded-lg text-xs text-zinc-400 hover:text-white hover:bg-white/5 transition-colors">Contact Contractor</button></GlassCard>
                    </div>
                    <div className="lg:col-span-2">
                        <GlassCard className="h-full"><div className="flex justify-between items-center mb-6"><h3 className="text-white font-medium text-lg">Project Timeline</h3><button onClick={() => setActiveTab('milestones')} className="text-xs text-blue-400 hover:text-blue-300">View All</button></div><div className="relative border-l border-zinc-800 ml-3 space-y-8">{BORROWER_MILESTONES.slice(0, 3).map((milestone, i) => (<div key={milestone.id} className="relative pl-8"><div className={`absolute -left-[9px] top-1 w-4 h-4 rounded-full border-2 flex items-center justify-center bg-[#0a0a0a] z-10 ${milestone.status === 'completed' ? 'border-emerald-500' : milestone.status === 'active' ? 'border-blue-500' : 'border-zinc-700'}`}>{milestone.status === 'completed' && <div className="w-2 h-2 bg-emerald-500 rounded-full" />}{milestone.status === 'active' && <div className="w-2 h-2 bg-blue-500 rounded-full animate-pulse" />}</div><div className="flex justify-between items-start"><div><h4 className="text-sm font-medium text-white">{milestone.title}</h4><p className="text-xs text-zinc-500 mt-0.5">{milestone.desc}</p></div><div className="text-right"><StatusBadge status={milestone.status} /><div className="text-xs text-zinc-500 mt-1">{milestone.date}</div></div></div></div>))}</div></GlassCard>
                    </div>
                </div>
            </div>
        );

        const BorrowerDocuments = () => (
            <div className="space-y-6 animate-in fade-in slide-in-from-bottom-4 duration-500">
                <div className="flex justify-between items-center"><div><h2 className="text-2xl font-semibold text-white">Document Vault</h2><p className="text-zinc-400 text-sm">Securely upload and manage compliance documents.</p></div><button className="px-4 py-2 bg-blue-600 hover:bg-blue-500 text-white rounded-lg text-sm font-medium transition-colors shadow-lg shadow-blue-500/20 flex items-center gap-2"><UploadCloud size={16} /> Upload New</button></div>
                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">{BORROWER_DOCS.map((doc) => (<GlassCard key={doc.id} className="flex flex-col h-full group"><div className="flex justify-between items-start mb-4"><div className="p-3 rounded-lg bg-zinc-800/50 border border-white/5 group-hover:border-blue-500/30 transition-colors"><FileText size={20} className="text-zinc-300 group-hover:text-blue-400 transition-colors" /></div><StatusBadge status={doc.status} /></div><div className="mb-4 flex-grow"><h3 className="text-white font-medium mb-1">{doc.name}</h3><p className="text-xs text-zinc-500">{doc.type} â€¢ {doc.date}</p></div>{doc.status === 'verified' ? (<button className="w-full py-2 border border-white/5 bg-white/5 rounded-lg text-xs text-zinc-400 flex items-center justify-center gap-2 hover:bg-white/10 hover:text-white transition-colors"><Download size={14} /> Download Copy</button>) : (<button className="w-full py-2 bg-blue-600/10 border border-blue-500/20 rounded-lg text-xs text-blue-400 flex items-center justify-center gap-2 hover:bg-blue-600/20 transition-colors">{doc.status === 'uploading' ? <RefreshCw size={14} className="animate-spin" /> : <UploadCloud size={14} />}{doc.action || 'Re-upload'}</button>)}</GlassCard>))}</div>
            </div>
        );

        const BorrowerMilestones = () => (
            <div className="space-y-6 animate-in fade-in slide-in-from-bottom-4 duration-500">
                <div className="flex flex-col md:flex-row md:items-center justify-between gap-4"><div><h2 className="text-2xl font-semibold text-white">Project Milestones</h2><p className="text-zinc-400 text-sm">Track progress and request drawdowns upon completion.</p></div></div>
                <div className="grid grid-cols-1 lg:grid-cols-4 gap-6">
                    <div className="lg:col-span-3 space-y-6">{BORROWER_MILESTONES.map((milestone, i) => (<GlassCard key={milestone.id} className={`relative ${milestone.status === 'locked' ? 'opacity-60' : ''}`}><div className="flex flex-col md:flex-row gap-6"><div className="flex-shrink-0"><div className={`w-12 h-12 rounded-full flex items-center justify-center border-2 ${milestone.status === 'completed' ? 'border-emerald-500 bg-emerald-500/10 text-emerald-400' : milestone.status === 'active' ? 'border-blue-500 bg-blue-500/10 text-blue-400' : 'border-zinc-700 bg-zinc-800 text-zinc-600'}`}>{milestone.status === 'completed' ? <CheckCircle2 size={24} /> : milestone.status === 'active' ? <Activity size={24} /> : <Lock size={24} />}</div>{i !== BORROWER_MILESTONES.length - 1 && (<div className="hidden md:block w-0.5 h-full bg-zinc-800 absolute left-[30px] top-[70px] -z-10" />)}</div><div className="flex-grow"><div className="flex justify-between items-start mb-2"><div><h3 className="text-lg font-semibold text-white">{milestone.title}</h3><span className="text-xs text-zinc-500 font-mono">{milestone.date}</span></div><div className="text-right"><div className="text-lg font-bold font-mono text-white">{milestone.amount}</div><StatusBadge status={milestone.status} /></div></div><p className="text-sm text-zinc-400 mb-4">{milestone.desc}</p>{milestone.status === 'active' && (<div className="bg-blue-500/5 border border-blue-500/10 rounded-xl p-4"><h4 className="text-sm font-medium text-blue-200 mb-3 flex items-center gap-2"><Camera size={16} /> Evidence Required for Drawdown</h4><div className="flex gap-3"><button className="flex-1 py-2 rounded-lg bg-zinc-800 border border-white/5 text-xs text-zinc-300 hover:text-white hover:bg-zinc-700 transition-colors flex items-center justify-center gap-2"><Camera size={14} /> Take Site Photo</button><button className="flex-1 py-2 rounded-lg bg-zinc-800 border border-white/5 text-xs text-zinc-300 hover:text-white hover:bg-zinc-700 transition-colors flex items-center justify-center gap-2"><UploadCloud size={14} /> Upload Invoice</button></div><button className="w-full mt-3 py-3 rounded-lg bg-blue-600 hover:bg-blue-500 text-white font-medium text-sm transition-colors shadow-lg shadow-blue-500/20">Submit Drawdown Request</button></div>)}</div></div></GlassCard>))}</div>
                    <div className="space-y-6">
                        <GlassCard><h3 className="text-white font-medium text-sm mb-4">Drawdown Summary</h3><div className="space-y-4"><div className="flex justify-between text-sm"><span className="text-zinc-500">Total Facility</span><span className="text-white">Rp 2.50 M</span></div><div className="flex justify-between text-sm"><span className="text-zinc-500">Released</span><span className="text-emerald-400">Rp 1.00 M</span></div><div className="flex justify-between text-sm"><span className="text-zinc-500">Remaining</span><span className="text-zinc-300">Rp 1.50 M</span></div><div className="h-px bg-white/5 my-2" /><div className="flex justify-between text-sm"><span className="text-zinc-500">Progress</span><span className="text-blue-400">40%</span></div></div></GlassCard>
                        <div className="p-4 rounded-xl bg-blue-500/10 border border-blue-500/20"><div className="flex items-start gap-3"><AlertCircle size={18} className="text-blue-400 shrink-0 mt-0.5" /><div><h4 className="text-sm font-medium text-blue-200">Next Site Visit</h4><p className="text-xs text-blue-400/70 mt-1">Secha Surveyor scheduled for <strong className="text-blue-300">Dec 15, 2024</strong>.</p></div></div></div>
                    </div>
                </div>
            </div>
        );

        const SettingsView = () => (
            <div className="max-w-4xl mx-auto space-y-8 animate-in fade-in slide-in-from-bottom-4 duration-500">
                <h2 className="text-2xl font-semibold text-white mb-6">System Configuration</h2>
                <GlassCard><div className="flex items-center gap-4 mb-6"><div className="w-16 h-16 rounded-full bg-gradient-to-tr from-zinc-700 to-zinc-600 border border-white/10 flex items-center justify-center text-2xl font-bold text-white shadow-lg">JD</div><div><h3 className="text-white font-medium text-lg">John Doe</h3><p className="text-zinc-500 text-sm">Lead Risk Officer â€¢ Admin Access</p></div><button className="ml-auto px-4 py-2 border border-white/10 rounded-lg text-sm text-zinc-400 hover:text-white hover:bg-white/5 transition-colors flex items-center gap-2"><Pencil size={14} /> Edit Profile</button></div></GlassCard>
                <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <GlassCard><h3 className="text-white font-medium mb-4 flex items-center gap-2"><Cpu size={18} className="text-blue-400" /> Engine Parameters</h3><div className="space-y-4">{[{ label: 'Auto-Approval Threshold', value: '95+' }, { label: 'Manual Review Trigger', value: '< 80' }, { label: 'Max LTV (Basel III)', value: '75%' }, { label: 'Cost Overrun Buffer', value: '15%' }].map((setting, i) => (<div key={i} className="flex items-center justify-between py-3 border-b border-white/5 last:border-0"><span className="text-zinc-400 text-sm">{setting.label}</span><span className="text-white font-mono text-xs bg-blue-500/10 border border-blue-500/20 px-2 py-1 rounded text-blue-300">{setting.value}</span></div>))}</div></GlassCard>
                    <GlassCard><h3 className="text-white font-medium mb-4 flex items-center gap-2"><Lock size={18} className="text-amber-400" /> Security & API</h3><div className="space-y-4"><div className="p-3 bg-black/40 rounded-lg border border-white/5"><div className="text-xs text-zinc-500 mb-1">API Key (Production)</div><div className="flex items-center justify-between"><code className="text-emerald-400 text-sm font-mono">sk_live_51M...892x</code><button className="text-zinc-500 hover:text-white"><RefreshCw size={14} /></button></div></div><div className="flex items-center justify-between"><span className="text-zinc-400 text-sm">2-Factor Auth</span><div className="w-10 h-5 bg-blue-600 rounded-full relative cursor-pointer shadow-[0_0_10px_rgba(37,99,235,0.5)]"><div className="absolute right-1 top-1 w-3 h-3 bg-white rounded-full shadow-sm" /></div></div><div className="flex items-center justify-between"><span className="text-zinc-400 text-sm">IP Whitelisting</span><div className="w-10 h-5 bg-zinc-700 rounded-full relative cursor-pointer"><div className="absolute left-1 top-1 w-3 h-3 bg-zinc-400 rounded-full shadow-sm" /></div></div></div></GlassCard>
                </div>
            </div>
        );
        
        const BorrowerSettings = () => (
            <div className="max-w-2xl mx-auto space-y-6 animate-in fade-in slide-in-from-bottom-4 duration-500">
                <h2 className="text-2xl font-semibold text-white mb-6">Account Settings</h2>
                <GlassCard>
                    <div className="flex items-center gap-4 mb-6">
                        <div className="w-20 h-20 rounded-full bg-zinc-800 border border-white/10 flex items-center justify-center"><UserCircle size={40} className="text-zinc-500" /></div>
                        <div><h3 className="text-lg font-medium text-white">Pak Budi Santoso</h3><p className="text-sm text-zinc-500">Borrower ID: SECHA-B-8921</p></div>
                        <button className="ml-auto px-4 py-2 bg-white/5 border border-white/10 rounded-lg text-sm text-zinc-300 hover:text-white transition-colors flex items-center gap-2"><Pencil size={14} /> Edit Profile</button>
                    </div>
                    <div className="space-y-4"><div className="grid grid-cols-2 gap-4"><div className="space-y-1"><label className="text-xs text-zinc-500 uppercase">Email</label><input type="text" value="budi.s@gmail.com" disabled className="w-full bg-black/20 border border-white/5 rounded-lg px-3 py-2 text-sm text-zinc-400" /></div><div className="space-y-1"><label className="text-xs text-zinc-500 uppercase">Phone</label><input type="text" value="+62 812 3456 7890" disabled className="w-full bg-black/20 border border-white/5 rounded-lg px-3 py-2 text-sm text-zinc-400" /></div></div></div>
                </GlassCard>
                <GlassCard><h3 className="text-white font-medium text-sm mb-4">Notifications</h3><div className="space-y-4"><div className="flex items-center justify-between"><div><div className="text-sm text-zinc-200">Drawdown Updates</div><div className="text-xs text-zinc-500">Get notified when funds are released</div></div><div className="w-10 h-5 bg-blue-600 rounded-full relative cursor-pointer"><div className="absolute right-1 top-1 w-3 h-3 bg-white rounded-full shadow-sm" /></div></div><div className="flex items-center justify-between"><div><div className="text-sm text-zinc-200">Milestone Reminders</div><div className="text-xs text-zinc-500">Alerts for upcoming due dates</div></div><div className="w-10 h-5 bg-blue-600 rounded-full relative cursor-pointer"><div className="absolute right-1 top-1 w-3 h-3 bg-white rounded-full shadow-sm" /></div></div></div></GlassCard>
                <button className="w-full py-3 rounded-xl border border-rose-500/20 text-rose-400 hover:bg-rose-500/10 transition-colors flex items-center justify-center gap-2"><LogOut size={16} /> Sign Out</button>
            </div>
        );

        // --- 6. MAIN APP ---
        const SechaCreditEngine = () => {
            const [activeTab, setActiveTab] = useState('dashboard');
            const [phase, setPhase] = useState(3);
            const [userRole, setUserRole] = useState('bank');
            const [isLoading, setIsLoading] = useState(true);

            useEffect(() => {
                const timer = setTimeout(() => setIsLoading(false), 1500);
                return () => clearTimeout(timer);
            }, []);

            const handleRoleSwitch = () => {
                setIsLoading(true);
                setUserRole(prev => prev === 'bank' ? 'borrower' : 'bank');
                setActiveTab('dashboard');
                setTimeout(() => setIsLoading(false), 800);
            };

            return (
                <div className="min-h-screen flex overflow-hidden">
                    <div className="fixed inset-0 pointer-events-none">
                        <div className="absolute top-[-20%] left-[-10%] w-[50%] h-[50%] bg-blue-900/10 rounded-full blur-[120px]" />
                        <div className="absolute bottom-[-20%] right-[-10%] w-[50%] h-[50%] bg-indigo-900/10 rounded-full blur-[120px]" />
                    </div>

                    <Navigation activeTab={activeTab} setActiveTab={setActiveTab} userRole={userRole} />

                    <main className="flex-1 h-screen overflow-y-auto relative flex flex-col pb-16 md:pb-0 z-10">
                        <header className="sticky top-0 z-40 px-6 lg:px-8 py-5 bg-[#050505]/80 backdrop-blur-xl border-b border-white/5 flex justify-between items-center shrink-0">
                            <h1 className="text-xl font-semibold text-white tracking-tight">
                                {activeTab === 'dashboard' ? (userRole === 'bank' ? 'Bank View' : 'My Dashboard') : 
                                activeTab === 'engine' ? 'Risk Engine' : 
                                activeTab === 'origination' ? 'Deal Flow' :
                                activeTab.charAt(0).toUpperCase() + activeTab.slice(1)}
                            </h1>
                            <div className="flex items-center gap-4 lg:gap-6">
                                {userRole === 'bank' && (
                                    <div className="hidden md:flex bg-black/40 p-1 rounded-lg border border-white/10">
                                        {[1, 2, 3].map((p) => (
                                            <button key={p} onClick={() => setPhase(p)} className={`px-4 py-1.5 rounded-md text-xs font-medium transition-all duration-200 ${phase === p ? 'bg-zinc-800 text-white shadow-sm ring-1 ring-white/10' : 'text-zinc-500 hover:text-zinc-300'}`}>Phase {p}</button>
                                        ))}
                                    </div>
                                )}
                                <button onClick={handleRoleSwitch} className="hidden md:flex items-center gap-2 px-3 py-1.5 rounded-lg border border-white/10 text-xs font-medium text-zinc-400 hover:text-white hover:bg-white/5 transition-colors">
                                    {userRole === 'bank' ? <UserCircle size={14} /> : <Building2 size={14} />} Switch to {userRole === 'bank' ? 'Borrower' : 'Bank'} View
                                </button>
                                <div className="flex items-center gap-4 border-l border-white/5 pl-6">
                                    <button className="relative text-zinc-400 hover:text-white transition-colors"><Bell size={20} /><span className="absolute top-0 right-0 w-2 h-2 bg-rose-500 rounded-full border-2 border-[#050505] animate-pulse" /></button>
                                    <div className="w-8 h-8 rounded-full bg-gradient-to-tr from-zinc-700 to-zinc-600 border border-white/10 ring-2 ring-white/5 cursor-pointer hover:ring-white/20 transition-all" />
                                </div>
                            </div>
                        </header>

                        <div className="flex-1 p-4 lg:p-8 w-full max-w-[1920px] mx-auto">
                            {userRole === 'bank' && (
                                <div className="hidden md:flex mb-8 items-center justify-between">
                                    <div className={`pl-4 border-l-2 ${PHASE_CONFIG[phase].color.replace('text', 'border')}`}>
                                        <span className={`text-xs font-mono uppercase tracking-wider ${PHASE_CONFIG[phase].color}`}>Current State: {PHASE_CONFIG[phase].badge}</span>
                                        <p className="text-zinc-500 text-sm mt-1 max-w-2xl">{phase === 1 && "Manual risk assessment with rule-based LTV checks."}{phase === 2 && "Hybrid data integration for automated contractor vetting."}{phase === 3 && "Fully autonomous renovation underwriting and disbursement control."}</p>
                                    </div>
                                </div>
                            )}

                             <button onClick={handleRoleSwitch} className="md:hidden w-full mb-6 flex items-center justify-center gap-2 px-3 py-3 rounded-xl border border-white/10 bg-white/5 text-sm font-medium text-zinc-200">
                                {userRole === 'bank' ? <UserCircle size={16} /> : <Building2 size={16} />} Switch to {userRole === 'bank' ? 'Borrower' : 'Bank'} View
                             </button>

                            {isLoading ? (
                                <div className="h-[60vh] flex flex-col items-center justify-center gap-4">
                                    <div className="relative"><div className="w-16 h-16 border-4 border-blue-500/10 rounded-full" /><div className="w-16 h-16 border-4 border-blue-500 border-t-transparent rounded-full animate-spin absolute inset-0 shadow-[0_0_20px_rgba(59,130,246,0.3)]" /><Cpu className="absolute inset-0 m-auto text-blue-500/50 animate-pulse" size={24} /></div>
                                    <p className="text-zinc-500 font-mono text-sm animate-pulse tracking-widest">{userRole === 'bank' ? 'CONNECTING TO CORE BANKING...' : 'LOADING PROJECT DATA...'}</p>
                                </div>
                            ) : (
                                <div className="w-full animate-in fade-in zoom-in-95 duration-500">
                                    {userRole === 'bank' ? (
                                        <React.Fragment>
                                            {activeTab === 'dashboard' && <DashboardView phase={phase} />}
                                            {activeTab === 'engine' && <EngineView />}
                                            {activeTab === 'portfolio' && <PortfolioView />}
                                            {activeTab === 'origination' && <OriginationView />}
                                            {activeTab === 'settings' && <SettingsView />}
                                        </React.Fragment>
                                    ) : (
                                        <React.Fragment>
                                            {activeTab === 'dashboard' && <BorrowerDashboard setActiveTab={setActiveTab} />}
                                            {activeTab === 'documents' && <BorrowerDocuments />}
                                            {activeTab === 'milestones' && <BorrowerMilestones />}
                                            {activeTab === 'settings' && <BorrowerSettings />}
                                        </React.Fragment>
                                    )}
                                </div>
                            )}
                        </div>
                    </main>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<SechaCreditEngine />);
    </script>
</body>
</html>
